<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ±å’²</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #fdf6e3;
            color: #5d5245;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .game-container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 95%;
            max-width: 1000px;
            overflow: auto;
            position: relative; /* ç®¡ç†è€…ãƒœã‚¿ãƒ³ã®åŸºæº– */
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¸é¸æŠ */
        .stage-select {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            background: #fff8e1;
            padding: 5px 15px;
            border-radius: 20px;
        }
        .stage-label { font-size: 1.2rem; font-weight: bold; min-width: 80px; text-align: center; }
        .stage-btn {
            background: #ffecb3; color: #795548; padding: 5px 15px;
            border-radius: 15px; cursor: pointer; border: none; font-weight: bold; min-width: 40px;
            box-shadow: 0 3px 0 rgba(0,0,0,0.1);
        }
        .stage-btn:active { transform: translateY(2px); box-shadow: none; }
        .stage-btn:disabled { opacity: 0.5; cursor: default; transform: none; box-shadow: none;}

        #statusMessage {
            font-size: 1.2rem; margin-bottom: 10px; background-color: #e0f2fe; color: #0284c7;
            padding: 8px 20px; border-radius: 20px; font-weight: bold;
        }

        /* ã‚­ãƒ£ãƒ©å¾…ã¡è¡Œåˆ— */
        #charQueue { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; justify-content: center; }
        .queue-item {
            background: #f1f5f9; padding: 5px 15px; border-radius: 10px; border: 2px solid #cbd5e1;
            color: #64748b; font-size: 0.9rem; font-weight: bold;
        }
        .queue-item.active { background: #fff7ed; border-color: #fbbf24; color: #b45309; transform: scale(1.1); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .queue-item.done { background: #e2e8f0; color: #94a3b8; text-decoration: line-through; opacity: 0.6; }

        canvas {
            background-color: #f8fafc; border-radius: 16px; border: 4px solid #e2e8f0;
            image-rendering: pixelated; max-width: 100%; height: auto;
        }

        .controls {
            margin-top: 30px; display: flex; justify-content: center; gap: 20px; width: 100%; flex-wrap: wrap;
        }

        .action-btn {
            border: none; padding: 12px 30px; border-radius: 50px; font-family: inherit; font-size: 1.1rem;
            font-weight: bold; color: white; cursor: pointer;
            box-shadow: 0 5px 0 rgba(0,0,0,0.15), inset 0 3px 5px rgba(255,255,255,0.3);
            transition: all 0.1s; position: relative; top: 0; min-width: 140px;
        }
        .action-btn:active { top: 4px; box-shadow: 0 1px 0 rgba(0,0,0,0.15), inset 0 4px 5px rgba(0,0,0,0.1); }
        .action-btn:disabled { background: #cbd5e1; box-shadow: none; cursor: not-allowed; top: 2px; }

        #startBtn { background: linear-gradient(to bottom, #ff9aae, #ff758f); }
        #resetBtn { background: linear-gradient(to bottom, #aaddff, #8cb8ff); }
        button span { font-size: 1.2rem; margin-right: 6px; vertical-align: middle; }

        /* â–¼â–¼â–¼ ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”¨CSS â–¼â–¼â–¼ */
        #adminBtn {
            position: fixed; bottom: 10px; right: 10px;
            background: #333; color: #fff; border: none; padding: 8px 12px;
            border-radius: 5px; cursor: pointer; opacity: 0.6; font-size: 0.8rem; z-index: 999;
        }
        #adminBtn:hover { opacity: 1; }

        #adminModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 1000;
        }
        .admin-content {
            background: #fff; padding: 25px; border-radius: 15px; width: 90%; max-width: 500px;
            display: flex; flex-direction: column; gap: 15px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .admin-content textarea {
            width: 100%; height: 120px; font-family: monospace; padding: 10px;
            border: 2px solid #ddd; border-radius: 8px; resize: vertical; box-sizing: border-box;
        }
        .link-btn {
            display: block; background-color: #4CAF50; color: white; text-align: center;
            text-decoration: none; padding: 12px; border-radius: 8px; font-weight: bold;
        }
        .close-btn { background: #94a3b8; border: none; padding: 10px; cursor: pointer; border-radius: 8px; color: white; font-weight: bold;}

        /* --- ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
    #controls {
        margin-top: 20px;
        display: flex;         /* æ¨ªä¸¦ã³ã«ã™ã‚‹ */
        justify-content: center; /* ä¸­å¤®å¯„ã› */
        gap: 15px;             /* ãƒœã‚¿ãƒ³åŒå£«ã®é–“éš”ã‚’åºƒã‚ã« */
    }

    /* --- ãƒœã‚¿ãƒ³å…±é€šã®ã‹ã‚ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
    button {
        /* ä¸¸ã¿ã¨ã‚µã‚¤ã‚º */
        border-radius: 50px;       /* å®Œå…¨ã«ä¸¸ãã™ã‚‹ï¼ˆãƒ”ãƒ«å‹ï¼‰ */
        padding: 12px 25px;        /* å†…å´ã®ä½™ç™½ã‚’ãŸã£ã·ã‚Šã¨ã‚‹ */
        border: none;              /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç·šã‚’æ¶ˆã™ */
        
        /* ãƒ•ã‚©ãƒ³ãƒˆã¨è‰² */
        font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
        font-weight: bold;
        font-size: 16px;
        color: white;              /* æ–‡å­—è‰²ã¯ç™½ã§æ¸…æ½”æ„Ÿ */
        
        /* å‹•ãã¨å½± */
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* ãµã‚“ã‚ã‚Šã—ãŸå½± */
        transition: all 0.3s ease; /* ãµã‚ã£ã¨å‹•ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    }

    /* ãƒã‚¦ã‚¹ãŒä¹—ã£ãŸæ™‚ã®å‹•ã */
    button:hover {
        transform: translateY(-3px); /* å°‘ã—æµ®ãä¸ŠãŒã‚‹ */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15); /* å½±ã‚’æ¿ƒãã™ã‚‹ */
    }

    /* ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã®å‹•ã */
    button:active {
        transform: translateY(0);    /* å…ƒã®ä½ç½®ã«æˆ»ã‚‹ */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* --- å„ãƒœã‚¿ãƒ³ã®è‰²åˆ†ã‘ï¼ˆãƒ‘ã‚¹ãƒ†ãƒ«èª¿ãƒ»ãƒãƒƒãƒˆãªè‰²ï¼‰ --- */

    /* ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ï¼šçˆ½ã‚„ã‹ãªé’ */
    #start-btn {
        background-color: #6c5ce7; /* å°‘ã—ç´«ãŒã‹ã£ãŸãŠã—ã‚ƒã‚Œãªé’ */
    }

    /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ï¼šè½ã¡ç€ã„ãŸèµ¤ */
    #reset-btn {
        background-color: #ff7675; /* ã‚µãƒ¼ãƒ¢ãƒ³ãƒ”ãƒ³ã‚¯ã«è¿‘ã„èµ¤ */
    }

    /* ã‚¹ãƒ­ãƒ¼ãƒœã‚¿ãƒ³ï¼šã‚„ã‚ã‚‰ã‹ã„é»„è‰² */
    #slow-btn {
        background-color: #fdcb6e; /* ãã¤ã™ããªã„é»„è‰² */
        color: #2d3436;            /* é»„è‰²ã®æ™‚ã¯æ–‡å­—ã‚’æ¿ƒã„è‰²ã«ã™ã‚‹ã¨è¦‹ã‚„ã™ã„ */
    }

    /* ã‚¹ãƒ­ãƒ¼ä¸­ï¼ˆONã®çŠ¶æ…‹ï¼‰ï¼šå°‘ã—æ¿ƒã„ã‚ªãƒ¬ãƒ³ã‚¸ */
    #slow-btn.active {
        background-color: #e17055;
        color: white;
        box-shadow: inset 0 3px 5px rgba(0,0,0,0.2); /* æŠ¼ã•ã‚Œã¦ã„ã‚‹å‡¹ã¿æ„Ÿ */
    }
    #stageSelect {
        font-family: 'M PLUS Rounded 1c', sans-serif;
        font-size: 1.1rem;
        font-weight: bold;
        color: #5d5245;
        background-color: #fff8e1; /* èƒŒæ™¯è‰² */
        border: 2px solid #ffecb3; /* æ ç·š */
        border-radius: 12px;
        padding: 5px 10px;
        cursor: pointer;
        outline: none;
        text-align: center;
        appearance: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®çŸ¢å°ã‚’æ¶ˆã™ï¼ˆä¸€éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶ç”¨ï¼‰ */
    }
    #stageSelect:hover {
        background-color: #fff3cd;
        border-color: #ffe082;
    }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="stage-select">
            <button id="prevStageBtn" class="stage-btn">â—€</button>
            
            <select id="stageSelect"></select>
            
            <button id="nextStageBtn" class="stage-btn">â–¶</button>
        </div>

        <div id="statusMessage">èª­ã¿è¾¼ã¿ä¸­...</div>
        <div id="charQueue"></div>

        <canvas id="gameCanvas"></canvas>
        
        <div class="controls">
            <button id="resetBtn" class="action-btn"><span>â®</span>ãƒªã‚»ãƒƒãƒˆ</button>
            <button id="startBtn" class="action-btn"><span>â–¶</span>ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

            <button id="slow-btn">ğŸ¢ ã‚¹ãƒ­ãƒ¼</button>
        </div>
    </div>

    <button id="adminBtn">âš™ï¸ ç®¡ç†è€…</button>

    <div id="adminModal">
        <div class="admin-content">
            <h3 style="margin:0; text-align:center;">ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
            
            <a href="https://mrwater12.github.io/hanasaka_builder/" target="_blank" class="link-btn">ğŸ”— Googleã¸ç§»å‹•</a>
            
            <hr style="width:100%; border:0; border-top:1px solid #eee;">

            <div style="font-weight:bold; font-size:0.9rem;">ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰ (JSON)</div>
            <textarea id="stageInput" placeholder='{"map": [[1, 0, 5, 0, 5, 0, 1],[0, 0, 1, 1, 1, 1, 2],[1, 0, 5, 0, 5, 0, 1]],"characters": ["RIGHT"],"objects": [{ "type": "glass", "x": 2, "y": 0, "isSafe": true }, { "type": "glass", "x": 2, "y": 2, "isSafe": false },{ "type": "glass", "x": 4, "y": 0, "isSafe": false },{ "type": "glass", "x": 4, "y": 2, "isSafe": true } ],"items": []}'></textarea>
            
            <button id="loadCustomStageBtn" class="action-btn" style="background:#fbbf24; min-width:auto;">ğŸ“¥ èª­ã¿è¾¼ã‚“ã§éŠã¶</button>
            <button id="closeAdminBtn" class="close-btn">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script type="module" src="./js/main.js"></script>
</body>
</html>